
== 安装
=== master
==== 安装
. 首先下载k8s
+
https://github.com/kubernetes/kubernetes/releases/download/v1.5.7/kubernetes.tar.gz
+
. 解压
+
tar -xvf kubernetes.tar.gz 
. 进入 kubernetes/cluster/ 执行命令./get-kube-binaries.sh
+
. 根据提示移动处理文件
+
. 进入server 解压kubernetes-server-linux-amd64.tar.gz

. 导入镜像
.. 下载etcd 镜像
+
docker pull googlecontainer/etcd:2.2.1
.. 导入master相关镜像
... 进入上面解压的kubernetes-server-linux-amd64.tar.gz 里面的bin目录进行镜像导入
+
... 使用docker load -i 镜像.tar 来导入
* docker load < kubernetes/server/bin/kube-proxy.tar
* docker load < kubernetes/server/bin/kube-apiserver.tar
* docker load < kubernetes/server/bin/kube-controller-manager.tar
* docker load < kubernetes/server/bin/kube-scheduler.tar


==== 启动
. 启动etcd
+
-----
docker run -d  --name etcd -p 2379:2379 -p 2380:2380 -p 4001:4001 -p 7001:7001 googlecontainer/etcd:2.2.1 etcd --listen-peer-urls 'http://0.0.0.0:2380,http://0.0.0.0:7001' --listen-client-urls='http://0.0.0.0:2379,http://0.0.0.0:4001'  --advertise-client-urls 'http://0.0.0.0:2379,http://0.0.0.0:4001'

docker exec -it etcd etcdctl set /github.myking520.com/network/config '{"Network": "11.0.0.0/16"}'
-----
+
. 启动apiserver
+
-----
./kube-apiserver --insecure-bind-address=0.0.0.0 \
                 --insecure-port=8080 \
                 --service-cluster-ip-range='10.254.0.0/16' \
                  --service-node-port-range=20000-60000 \
                 --etcd-servers=http://127.0.0.1:4001 \
                 --allow-privileged=false
-----
或者
+
------
docker run -it \
  --name=apiserver \
  --net=host \
  gcr.io/google_containers/kube-apiserver:77e85c0207d0e512f452ed2febfca00b \
  kube-apiserver \
  --insecure-bind-address="192.168.78.134" \
  --service-cluster-ip-range="11.0.0.0/16" \
  --etcd-servers="http://192.168.78.134:4001" \
  --secure-port=0 \
  --admission-control="NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota" \
  --v=2 \
  --storage-backend=etcd2

------
. 启动 controller-manager
+
---------
docker run -d \
  --name=cm \
  --net =host \
  gcr.io/google_containers/kube-controller-manager:0005ed016737cb2c14929aa8efdf5be7 \
  kube-controller-manager \
  --master=http://192.168.78.134:8080
---------
. 启动 scheduler
+
-----
docker run -d \
  --name=scheduler \
  gcr.io/google_containers/kube-scheduler:5e5a1fe4ee49b94c0f3d2e745a48cb65 \
  kube-scheduler \
  --master=http://192.168.78.134:8080
-----
. 查看信息 +
./kubectl -s 192.168.78.134:8080 version

=== etc 说明

==== 端口

* 2379 提供 HTTP API 服务
* 2380 与peer 通信
* 4001 是老的http api服务端口 已经被2379 所替换
* 7001 同样被2380所替换是老的端口
